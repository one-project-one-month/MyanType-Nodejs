<!DOCTYPE html>
<html>
<head>
  <title>Typing Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .buttons button { margin: 5px; padding: 10px 20px; cursor: pointer; }
    .result { margin-top: 20px; padding: 10px; background-color: #eef; border: 1px solid #ccc; min-height: 50px; white-space: pre-wrap; }
    .modal.hidden { display: none; }
    .modal {
      position: fixed;
      background-color: rgba(0, 0, 0, 0.6);
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex; align-items: center; justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      text-align: center;
    }
    .error-message { color: red; margin-top: 10px; }
  </style>
</head>
<body data-maxwords="<%= maxWords %>">
  <h1>Typing Test</h1>

  <div class="buttons">
    <button onclick="generateParagraph(10)">10</button>
    <button onclick="generateParagraph(25)">25</button>
    <button onclick="generateParagraph(50)">50</button>
    <button onclick="generateParagraph(100)">100</button>
    <button onclick="showPopup()">Custom</button>
  </div>

  <div id="customPopup" class="modal hidden">
    <div class="modal-content">
      <p>Enter word count (max <%= maxWords %>):</p>
      <input type="number" id="customCount" min="1" max="<%= maxWords %>">
      <button onclick="submitCustom()">Generate</button>
      <button onclick="hidePopup()">Cancel</button>
      <p id="error" class="error-message"></p>
    </div>
  </div>

  <div id="paragraphContainer" class="result"></div>

  <script>
    const maxWords = document.body.getAttribute('data-maxwords');
    const maxWordsNum = parseInt(maxWords);

    function generateParagraph(count) {
      fetch('/api/v1/engword/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ wordCount: count })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById('paragraphContainer').innerText = data.paragraph || data.error || "Something went wrong.";
      })
      .catch(err => {
        document.getElementById('paragraphContainer').innerText = "Error: " + err.message;
      });
    }

    function showPopup() {
      document.getElementById('customPopup').classList.remove('hidden');
      document.getElementById('error').innerText = '';
      document.getElementById('customCount').value = '';
    }

    function hidePopup() {
      document.getElementById('customPopup').classList.add('hidden');
    }

    function submitCustom() {
      const val = parseInt(document.getElementById('customCount').value);
      if (isNaN(val) || val <= 0 || val > maxWordsNum) {
        document.getElementById('error').innerText = `Please enter a number between 1 and ${maxWordsNum}.`;
        return;
      }
      hidePopup();
      generateParagraph(val);
    }
  </script>
</body>
</html>
